<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <script src="//unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
      <script>
  var vConsole = new window.VConsole();
</script>

<div onclick="sub()">123123</div>
<script>
  let register;
  function base64ToUint8Array (base64String) {
    let padding = '='.repeat((4 - base64String.length % 4) % 4)
    let base64 = (base64String + padding)
      .replace(/\-/g, '+')
      .replace(/_/g, '/')
    let rawData = window.atob(base64)
    let outputArray = new Uint8Array(rawData.length)

    for (let i = 0; i < rawData.length; i++) {
      outputArray[i] = rawData.charCodeAt(i)
    }
    return outputArray
  }

  async function sub() {
    if (typeof Notification === 'undefined') {
        return
      }

      if (Notification.permission === 'default') {
        await Notification.requestPermission();
      }
      if (Notification.permission !== 'granted') {
        return
      }
      register.pushManager.getSubscription().then((subscription) => {
        console.log('subscription get :>> ', subscription);
        subscription && subscription.unsubscribe();
        register.pushManager.subscribe({
          userVisibleOnly: true,
          applicationServerKey: base64ToUint8Array('BKYVdZt87Mwh7SIXPkJm8LkfnganvmPS0OA1WUx42uInbfr5xBan6whKYVBY7g5XFWols2CoygfmhaRIQ2gINp8')
        }).then((subscription) => {
          console.log('sub subscription :>> ', subscription);
        }).catch((err) => {
          console.log('sub err :>> ', err.message);
        })
      })
  }
  navigator.serviceWorker.register('/sw.js', {scope: '/nextjs-blog'}).then(function(reg) {
    register = reg
  })
</script>
</body>
</html>
